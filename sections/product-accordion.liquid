<div class="accordion-wrapper" data-multiple="{{ section.settings.allow_multiple }}">
  {% assign titles = product.metafields.rhteam.accordion_titles.value %}
  {% assign contents = product.metafields.rhteam.accordion_contents.value %}

  {% if titles and titles.size > 0 %}
    {% for title in titles %}
      {% assign idx = forloop.index0 %}
      {% assign content = contents[idx] %}
      {% if title != blank and content != blank %}
        <div class="accordion-item">
          <button class="accordion-header">{{ title }}</button>
          <div class="accordion-body">
            <p>{{ content }}</p>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}
</div>

{% javascript %}
document.addEventListener('DOMContentLoaded', function () {
  const wrapper = document.querySelector('.accordion-wrapper');
  if (!wrapper) return;

  const allowMultiple = wrapper.dataset.multiple === 'true';

  wrapper.querySelectorAll('.accordion-header').forEach(header => {
    header.addEventListener('click', () => {
      const item = header.parentElement;
      if (!allowMultiple) {
        wrapper.querySelectorAll('.accordion-item').forEach(i => {
          if (i !== item) i.classList.remove('active');
        });
      }
      item.classList.toggle('active');
    });
  });
});
{% endjavascript %}

{% style %}
.accordion-item {
  border-bottom: 1px solid #ddd;
  margin-bottom: 0.5rem;
}

.accordion-header {
  background: #f5f5f5;
  padding: 1rem;
  font-weight: bold;
  cursor: pointer;
  width: 100%;
  border: none;
  text-align: left;
}

.accordion-body {
  display: none;
  padding: 1rem;
  background: #fff;
}

.accordion-item.active .accordion-body {
  display: block;
}
{% endstyle %}

{% schema %}
{
  "name": "RHTeam: Product Accordion",
  "settings": [
    {
      "type": "checkbox",
      "id": "allow_multiple",
      "label": "Дозволити кілька відкритих секцій одночасно",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "RHTeam Accordion",
      "category": "Product"
    }
  ]
}
{% endschema %}
